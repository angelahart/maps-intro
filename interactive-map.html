<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://d3js.org/queue.v1.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<style type="text/css">
		.county {
			fill: red;
			stroke: black;
		}
	</style>
</head>
<body>
	<script>
	//javascript goes here
	var margin = {top: 20, right: 20, bottom: 20, left: 20};
	  	width = 750 - margin.left - margin.right,
	  	height = 700 - margin.top - margin.bottom;

	var svg = d3.select("body").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	    .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	queue()
	    .defer(d3.tsv, "merged-multirace.txt")
	    .defer(d3.json, "ca-counties.json")
	    .await(function(error, data, ca){
	    	data.forEach(function(d){
	    	dfips = +d.fips;
	    	d.fipsLeadingZero = "0" + d.fips;
	    	d.pcthispanicNum = +d.pcthispanic;		

	    
	    	

	    	});

	    	data = data.filter(function(d){
	    	return (d.year == 2010)

	    	});

	    	var counties = topojson.feature(ca, ca.objects.counties);

	    	counties.features.forEach(function(county){
	    	data.forEach(function(dataRow){
	    	if (dataRow.fipsLeadingZero == county.id){
	    	county.merged = dataRow;
	    	}	

	    	})

	    	});
	    	

	    var projection = d3.geo.albers()
	    .translate([width / 2, height / 2])
	    .parallels([34, 40.5])
	    .rotate([120, 0])
	    .scale(3000);



		var path = d3.geo.path().projection(projection);
	    
	    svg.selectAll(".county")
  		.data(counties.features)
		.enter().append("path")
  		.attr("class", "county")
  		.attr("d", path)
  		.style("fill", function(d){	
  		var value = d.merged.pcthispanic;
  		if (value > 0.5){
  			return "#0f0";
  		}
  		if (value > 0.3) {
  			return "#660";
  		}
  		if (value > 0.1) {
  			return "#330";
   	} else {
  		return "#00f";
  		}
  		});	



	    	console.log(counties, data);
	});//end of await any code beyond this comment won't load


	


	</script>
	</body>

</body>
</html>